language: python
sudo: false
cache: pip
env:
  global:
    - LD_PRELOAD=/lib/x86_64-linux-gnu/libSegFault.so
    - SEGFAULT_SIGNALS=all
      # CC_TEST_REPORTER_ID=
    - secure: "fdHy04Y7pRTlpO/idkbBBXwhxsPkEXUkCVmnmb91+G2DhhLwIrZ/XCnp6qYUz2jwG2pNqJs1GK5NZ0aWbg2N3v05oRI1AkII4AyTjJiMJBuC1OOWgspJKlv/AzqUe2ved2jLecFXFVWwyf5m99uxZNC4qQYOTbZmwrHC/jfGjwHYguitmJffLhQjqaAA1Fhh4CllSkm0BP+SGSO5hObK/pJjrrlnQkFA5yj1A2YWKAhcZgiENskNssEXUhRk8xVnjRlDcQndNaaO65Kejm3odf6yXJiBSJXBzdK2744g6+YrKg4mXPAKTTV+evdMwhkKvnUuKwqdNAtlfQ/fu1vtR/U+GJ23Zk2xkNMZVpqx0Yi4yDVggBylng9YyDwfKQLtVBcS3MXIZD45j9kaZORyF5XeDkjjEX1LckFMzD1FcQuSwrMgEcAo78OCB6CuK4Y3VSe6pf6EyF+JS4VHfy6D1mMfcTn1+B/ky8SXWFM7dITxh9KAoYm5WONr1lIOjdIC/zd/UPnl83YunDyCb0ryhyVDHzAlabD4S0IEM7nl8bPJgY4R5isUpfBKIH5L/do19SPpxeMHAK0+mquCcCGVLtJFczkC3RoBVWM4Suc8o5r1M20KUp+7tWU9jKgrWX/4R4njXnP0lnxdQEvX38gaj/mezx+9ov6QX9b3kkZB2VQ="
  matrix:
    - TOXENV=check
    - TOXENV=docs
matrix:
  include:
    - python: '2.7'
      env:
        - TOXENV=py27,codecov
    - python: '3.3'
      env:
        - TOXENV=py33,codecov
    - python: '3.4'
      env:
        - TOXENV=py34,codecov
    - python: '3.5'
      env:
        - TOXENV=py35,codecov
    - python: '3.6'
      env:
        - TOXENV=py36,codecov
    - python: 'pypy-5.4'
      env:
        - TOXENV=pypy,codecov

before_install:
  - python --version
  - uname -a
  - lsb_release -a

install:
  - pip install tox
  - pip install coverage
  - virtualenv --version
  - easy_install --version
  - pip --version
  - tox --version
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build
script:
  - tox -v
after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

after_failure:
  - more .tox/log/* | cat
  - more .tox/*/log/* | cat

notifications:
  email:
    on_success: never
    on_failure: always

deploy:
  # production pypi
  - provider: pypi
    distributions: sdist bdist_wheel
    user: bavo.van.achte
    password:
      secure: cKCBgEUOSUnlPbOxHCrXENlVgdMGnjNC+7nnutp/1xF8VEDF3aj9Br4u5LKrAYs0sm0AvnCyjhPvfKGPwyRDdfGBjoG06G+L+1hcfpgBlItmdSBqB8RxMm2B76si1ZlVI9gC58hlk/agFr2vik/mLXsH23rafB/2UwfB3ItTTx2J14xC5jlaqYR/srMJUi8YO5z6mGGLokfcz0KhYUHegOna38UcARM8rkAC2Je0xrPKZMlCoTI84dqwnFPW4zn3g/B5s3s18gmZu4fE4+J1g0PNMvxhbDP1TIBzPSWXLBv+YPSKrIT6+Q4R/kfDJFzLn3SmDDnNOpD/OC8ssqVJOcQL3HhKQ7EAcxX9W+/Rt7mIpdJdDXohiPrBl9EdRYbhB+KiPeo/dekAV6loUP/8cHuEgjcW/gE8t+HIqWsa5SO9yK7Sz8Ym+0ENdzS1df0iPOj2ebR3kb1iwINdFi7zIG6Utvlf7w1A2Qtx1xfI2+woPU+GOgQrpwdw64Wl1uo4l0kqTpFkytIG7BEVWC+zPPzqddi+3Ulf9AkWSjNDTqYafxZ9oqBJ5q7WPH8zyPQHotcHbnziTAnv7qRa+CTFLeME/KXNT8egToLK75G367lANTFIhMm8eSDS7wAxFWHacq8j68wNb38Yj1Rv1WMHQh14sxOkzQ4hVEV0xYY7Bj8=
    on:
      branch: master
      python: 3.6
      tags: true
